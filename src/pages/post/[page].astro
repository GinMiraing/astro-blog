---
import Layout from "@/layouts/Layout.astro";
import PostCard from "@/components/PostCard.astro";
import Pagination from "@/components/Pagination.astro";
import { CollectionEntry, getCollection } from "astro:content";

type GetStaticPathsProps = {
  paginate: Function;
};

interface Props {
  page: {
    data: CollectionEntry<"blog">[];
    start: number;
    end: number;
    total: number;
    currentPage: number;
    size: number;
    lastPage: number;
    url: {
      current: string;
      prev: string | undefined;
      next: string | undefined;
    };
  };
}

export async function getStaticPaths({ paginate }: GetStaticPathsProps) {
  const posts = await getCollection("blog");
  const reversePosts = posts.sort((a, b) => b.data.id - a.data.id);
  return paginate(reversePosts, { pageSize: 8 });
}

const { page } = Astro.props;
---

<Layout
  select={1}
  title={`胤的博客 - 全部文章 - ${page.currentPage}`}
  header="全部文章"
  description="『 那些景 那些事 那些人 』"
  banner="https://article.biliimg.com/bfs/article/db21424ab03851de47b22d94dc054e4796b04f4c.jpg"
>
  <div class="grid my-6 grid-cols-1 gap-4 divide-y">
    {
      page.data.map((post) => {
        return <PostCard post={post.data} slug={post.slug} />;
      })
    }
  </div>
  <Pagination next={page.url.next} prev={page.url.prev} />
</Layout>
